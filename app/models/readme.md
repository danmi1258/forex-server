clients
=======

клиенты (терминалы).  за каждым клиентом закреплен токен доступа. Токен не храниться в документе клиента.

При http запросе клиент передает помимо прочих параметров свой id и token.

По id ищется клиент. По токену проверяется его права на доступ.

в документе клиента также храниться информация по клиенту. его личные параметры.

идентификация клиента происходит через токен. токены храняться в отдельной базе Token.

Токены не идентифицируют клиента. Они разрешают доступ.

Поля
----

* openId
* subscriptions: {id, volume}

Принцип работы терминала-провайдера (ТП)
===================================

Терминал провайдер обращается на адрес: site.com/fx/set?token&id

в GET параметре терминал сообщает свой токен и id

в POST параметре терминал сообщяет параметры ордера и тип (открытие/закрытие).

при удачной идентификции:

в случае инфо по новому ордеру сервер делает соответствующую запись в журнал ордеров: Order
записывая параметры сделки.

В случае закрытия ордера сервер пытается найти сделку по ее магическому числу (или иному идентификатору)
и ставит в ней признак: closed = true.

В любом случае сбоя фиксируется соответствующая запись в журнал критичесчих замечаний Missing

Принцип работы терминала-исполнителя (ТИ)
====================================

Терминал исполнитель опрашивает сервер на предмет новых сделок. Для этого он имеет поле subscribers, в котором
указаны списки id провайдеров, сделки которых он копирует.

При очередном обращении сервер сканирует журнал ордеров на предмет новых сделок.

Как отличается новая сделка от уже захабренной
-----------------------------------------------

Документ коллеккции Order имеет поле subscribers {Array} - список ссылок на id терминалов, которые взяли ордер.
По этому полю можно определить, брал ли конкретный терминал ордер в исполнение.

Документ коллекции Client имеет поле subscribers в котором храняться ссылки на терминалы-провайдеры.

Терминалы провайдеры соответственно при добавлении новой сделки в коллекцию Order фиксируют в документе
свой id.  Order.provider

Т.е. ТИ связан с ордерами через TI.subscribers *-* Order.provider - по этой связи можно определить, какие ордера
нужны для ТИ.

Т.е. запрос на все новые ордера будет выглядеть так

"дай мне все ордера, где provider есть один из Client.subscriptions и close = false"

НО!  за одну сессию ТИ может получить два типа уведомлений.
1. уведомление о новом(ых) ордерах.
2. уведомление о закрытых ордерах.

c 1 разобрались
со 2м.  client.openedOrders {Array} - список ордеров (ссылок) которые были открыты ранее.
сервер проверяет этот стек у ТИ и если он не пустой, сканирует этот список с коллекцией Order на предмет
закрытых сделок. Если таковые имеются, сообщает о них терминалу.

ТИ при этом закрывает сделку, сообщает серверу об удачном закрытии сделки на адрес
../fx/orders/

//
fx/orders/set - сообщеине о новом ордере или о статусе ордера (закрыт).

fx/terminal/id/orders - список всех ордеров проведенных по терминалу
параметры: ?opened - список только открытых в данный момент сделок
?closed - список всех закрытых сделок
?q - доп парамтеры для фильтрации

fx/terminal/id/orders/open POST сообщает об удачном открытии сделки
fx/terminal/id/orders/close POST сообщает об удачном закрытии сделки


